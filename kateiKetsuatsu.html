<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>家庭血圧</title>
</head>

<body>
  <textarea id="matrix_input" rows="8" cols="60"></textarea><br>
  <button onclick="calKateiKetsuatsu()">家庭血圧を計算する</button>
  <br><br>
  <div id="result"></div>

  <script type="text/javascript">
    let resultDiv = document.getElementById("result")

    function calKateiKetsuatsu() {
      let matrixInput = document.getElementById('matrix_input').value.trim(); // テキストエリアの値を取得
      let rows = matrixInput.split(/\n/); // 改行で分割して行列の行を取得
      let matrix = []; // 行列を格納する配列を初期化

      // 各行をスペースまたはタブで分割して行列の列を取得
      for (let i = 0; i < rows.length; i++) {
        let cols = rows[i].split(/[\t ]+/).map(Number);
        if (cols.length != 8) { // 列数が8でない場合はエラーを表示して処理を終了
          alert('Error: Invalid matrix format!');
          return;
        }
        matrix.push(cols); // 行列の列を行列配列に追加
      }
      console.log(matrix);

      const averages = [];
      const indices = [[0, 2], [1, 3], [4, 6], [5, 7]];

      for (let i = 0; i < indices.length; i++) {
        let sum = 0;
        for (let j = 0; j < matrix.length; j++) {
          sum += matrix[j][indices[i][0]] + matrix[j][indices[i][1]];
        }
        averages.push((sum / (matrix.length * 2)).toFixed(0));
      }
      const morningClass = classifyBloodPressure(averages[0], averages[1]);
      const eveningClass = classifyBloodPressure(averages[2], averages[3]);

      resultDiv.innerHTML = "家庭血圧　7日分平均：<br>朝 " + averages[0] + "/" + averages[1] + " mmHg 《 " + morningClass + " 》水準です<br>" + "晩 " + averages[2] + "/" + averages[3] + " mmHg 《 " + eveningClass + " 》水準です";

      console.log("血圧平均 朝 " + averages[0] + "/" + averages[1] + "　mmHg　" + "晩 " + averages[2] + "/" + averages[3] + "　mmHg");
      console.log("血圧平均　朝　は 《 " + morningClass + " 》 水準です");
      console.log("血圧平均　晩　は 《 " + eveningClass + " 》 水準です");

      function classifyBloodPressure(systolic, diastolic) {
        if (systolic < 115 && diastolic < 75) {
          return "正常血圧";
        } else if (systolic >= 115 && systolic <= 124 && diastolic < 75) {
          return "正常高値血圧";
        } else if (systolic >= 125 && systolic <= 134 && diastolic <= 84) {
          return "高値血圧";
        } else if (systolic >= 135 && systolic <= 144 && diastolic <= 89) {
          return "Ⅰ度高血圧";
        } else if (systolic >= 145 && systolic <= 159 && diastolic <= 99) {
          return "Ⅱ度高血圧";
        } else if (systolic >= 160 || diastolic >= 100) {
          return "Ⅲ度高血圧";
        } else {
          return "測定値に誤りがあります";
        }
      }
    }

    // function classifyBloodPressure(systolic, diastolic) {
    //   if (systolic < 115 && diastolic < 75) {
    //     return "正常血圧";
    //   } else if (systolic >= 115 && systolic <= 124 && diastolic < 75) {
    //     return "正常高値血圧";
    //   } else if (
    //     (systolic >= 125 &&
    //       systolic <= 134 &&
    //       diastolic >= 75 &&
    //       diastolic <= 84) ||
    //     (systolic >= 125 && systolic <= 134 && diastolic < 75)
    //   ) {
    //     return "高値血圧";
    //   } else if (
    //     (systolic >= 135 &&
    //       systolic <= 144 &&
    //       diastolic >= 85 &&
    //       diastolic <= 89) ||
    //     (systolic >= 135 && systolic <= 144 && diastolic < 85)
    //   ) {
    //     return "Ⅰ度高血圧";
    //   } else if (
    //     (systolic >= 145 &&
    //       systolic <= 159 &&
    //       diastolic >= 90 &&
    //       diastolic <= 99) ||
    //     (systolic >= 145 && systolic <= 159 && diastolic < 90)
    //   ) {
    //     return "Ⅱ度高血圧";
    //   } else if (systolic >= 160 || diastolic >= 100) {
    //     return "Ⅲ度高血圧";
    //   } else {
    //     return "測定値に誤りがあります";
    //   }
    // }
  </script>
</body>

</html>